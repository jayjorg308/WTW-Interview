-- Create Campsite Table
CREATE TABLE Campsite(id int NOT NULL IDENTITY(1,1) PRIMARY KEY, name varchar(200));

-- Populate Campsite Table
INSERT INTO Campsite(name)
VALUES
    ('Campsite Number 1'),
    ('Campsite Number 2'),
    ('Campsite Number 3'),
    ('Campsite Number 4'),
    ('Campsite Number 5'),
    ('Campsite Number 6'),
    ('Campsite Number 7'),
    ('Campsite Number 8');
    
-- Create Reservation Table    
CREATE TABLE Reservation(
  id int NOT NULL IDENTITY(1,1) PRIMARY KEY, 
  campsiteId int NOT NULL FOREIGN KEY REFERENCES Campsite(id),
  [date] date);

-- Populate Reservation Table
INSERT INTO Reservation(campsiteId, [date])
VALUES
    (1, '2020-03-08'),
    (2, '2020-03-08'),
    (3, '2020-03-08'),
    (4, '2020-04-15'),
    (5, '2020-04-18'),
    (6, '2020-05-14'),
    (7, '2020-05-15'),
    (8, '2020-05-15'),
    (1, '2020-06-08'),
    (2, '2020-07-09');
    
-- Add Reservation Stored Procedure
CREATE PROCEDURE AddReservation @CampsiteId int, @ReservationDate date
AS
INSERT INTO Reservation(campsiteId, [date])
VALUES(@CampsiteId, @ReservationDate);

-- Cancel Reservation Stored Procedure
CREATE PROCEDURE CancelReservation @ReservationId int
AS
DELETE FROM Reservation WHERE id = @ReservationId;

-- Most Popular Day Function
CREATE FUNCTION getMostPopularDay()
RETURNS date
AS
BEGIN
	DECLARE @var date
    SELECT @var=(
      SELECT [date] 
      FROM Reservation 
      GROUP BY date 
      HAVING COUNT(date) = (SELECT TOP 1 COUNT(date)
        FROM Reservation
        GROUP BY [date]
        ORDER BY COUNT(date) DESC)) 
    RETURN @var
END;

-- Call Get Most Popular Day function
SELECT dbo.getMostPopularDay();
